<% if user_signed_in? %>
  <div align="right">
    <%= link_to('Logout', destroy_user_session_path, method: :delete) %>
  </div>
<% end %>
<h2 class="mb-5">Paryushan Signup Results</h2>
<p align="right">
  <%= link_to "New Event", new_event_path, class: 'btn btn-primary btn-sm' %>
  <%= link_to "Export to CSV", donations_path(:format => :csv), class: 'btn btn-secondary btn-sm' %>
</p>
<table class="table">
  <thead>
    <tr>
      <th scope="col">Donor</th>
      <th scope="col">Type</th>
      <th scope="col">Amount</th>
    </tr>
  </thead>
  <tbody>
    <% @events.each do |event| %>
      <tr class="table-secondary">
        <th colspan="4">
          <%= event.name %>
          <span class="dropdown" style="float:right;">
            <button class="btn btn-sm btn-outline-secondary dropdown-toggle no-caret" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-three-dots-vertical" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
              </svg>
            </button>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
              <%= link_to "Edit Event", edit_event_path(event), class: "dropdown-item" %>
              <%= link_to "Add Slot", new_event_event_slot_path(event), class: "dropdown-item" %>
              <div class="dropdown-divider"></div>
              <%= link_to "Delete Event", event, method: "delete", data: { confirm: "Are you sure you want to delete this event? Any associated sign up slots and donation records will be deleted.", disable_with: "Deleting..." }, class: "dropdown-item text-danger" %>
            </div>
          </span>
        </th>
      </tr>
      <% event.event_slots.each do |event_slot| %>
        <tr class="table<%= event_slot.donation ? "-success" : (event_slot.event.donation_type == "nakaro" ? "-warning" : "") %>">
          <td>
            <div><strong><%= event_slot.donation.try(:name) %></strong></div>
            <div><%= event_slot.donation.try(:email) %></div>
            <div><%= event_slot.donation.try(:phone) %></div>
            <% if event_slot.event.donation_type == 'boli' %>
              <div>Available at ghee boli</div>
            <% else %>
              <div><%= link_to 'Not Taken â€“ Sign Up', new_donation_path(id: event.id) unless event_slot.donation %></div>
            <% end %>
          </td>
          <td><%= event_slot.slot.name %></td>
          <td><%= number_to_currency(event_slot.donation.try(:amount)) %></td>
          <td><%= link_to "Delete", event_slot, method: "delete", data: { confirm: "Are you sure you want to delete this slot? Any associated donation records will also be deleted.", disable_with: "Deleting..." }, class: "text-danger" %></td>
        </tr>
      <% end %>
    <% end %>
  </tbody>
</table>
